{"remainingRequest":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/node_modules/vue-loader/lib/index.js??vue-loader-options!/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/src/components/chat_componenet/ChatLog.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/src/components/chat_componenet/ChatLog.vue","mtime":1606213248189},{"path":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBnbG9iYWwgZnJvbSAnLi4vZ2xvdmFsX3ZhcicKLyogd3MgKi8Kd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCl7CiAgdmFyIGxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2cnKQoKICAvLyBXU+mAo+e3mu+8muaOpeaUtuW7o+aSreioiuaBrwogIGlmICh3aW5kb3dbJ1dlYlNvY2tldCddKSB7CiAgICBnbG9iYWwuQ09OTiA9IG5ldyBXZWJTb2NrZXQoJ3dzOi8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0ICsiL3dzIisgbG9jYXRpb24ucGF0aG5hbWUgKyBsb2NhdGlvbi5zZWFyY2gpCiAgICBnbG9iYWwuQ09OTi5vbmNsb3NlID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpCiAgICAgIGl0ZW0uaW5uZXJIVE1MID0gJzxiPkNvbm5lY3Rpb24gY2xvc2VkLjwvYj4nCiAgICAgIGFwcGVuZExvZyhpdGVtKQogICAgfQogICAgZ2xvYmFsLkNPTk4ub25tZXNzYWdlID0gZnVuY3Rpb24gKGV2dCkgewogICAgICB2YXIgbWVzc2FnZXMgPSBldnQuZGF0YS5zcGxpdCgnXG4nKQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lc3NhZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgSGFuZGxlTWVzc2FnZShtZXNzYWdlc1tpXSkKICAgICAgfQogICAgfQogIH0gZWxzZSB7CiAgICB2YXIgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpCiAgICBpdGVtLmlubmVySFRNTCA9ICc8Yj5Zb3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBXZWJTb2NrZXRzLjwvYj4nCiAgICBhcHBlbmRMb2coaXRlbSkKICB9CgoKCiAgLy8g6JmV55CG6KiK5oGvCiAgZnVuY3Rpb24gSGFuZGxlTWVzc2FnZSAobWVzc2FnZSkgewogICAgdmFyIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKQogICAgdmFyIGNoYXQgPSBKU09OLnBhcnNlKG1lc3NhZ2UpCiAgICB2YXIgY2hhdFRpbWUgPSBuZXcgRGF0ZShjaGF0LnRpbWUpLnRvTG9jYWxlU3RyaW5nKCd6aC1UVycpCiAgICAvLyDliKTmlrfmmK/lkKbngrrns7vntbHoqIrmga8KICAgIGlmIChjaGF0LnNlbmRlciA9PT0gJ1NZUycpIHsKICAgICAgLy8g57O757WxaGludCDkvb/nlKjogIXlkI3llq4KICAgICAgaWYgKGNoYXQudHlwZSA9PT0gJ0gnKSB7CiAgICAgICAgdmFyIGluZm8gPSBKU09OLnBhcnNlKGNoYXQuY29udGVudCkKICAgICAgICBnbG9iYWwuT05MSU5FID0gW10gLy8g5riF56m65Y6f5L6G55qE5Zyo57ea5Lq65ZOh5YiX6KGoCgogICAgICAgIGlmIChnbG9iYWwuQ0hBVFJPT00gIT09IGluZm8ucm9vbV9pbmZvKSB7CiAgICAgICAgICBhbGVydCgn6IGK5aSp5a6k5L2N572u5Ye66YyvIScgKyBnbG9iYWwuQ0hBVFJPT00gKyBpbmZvLnJvb21faW5mbykKICAgICAgICB9CgogICAgICAgIC8vIOWcqOe3muWIl+ihqAogICAgICAgIHZhciBtZW1iZXJzID0gaW5mby51c2VyX2luZm8uc3BsaXQoJywnKQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWVtYmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKG1lbWJlcnNbaV0gPT09IGdsb2JhbC5VU0VSKSB7IGNvbnRpbnVlIH0KCiAgICAgICAgICBsZXQgdG1wID0geyAndXNlcm5hbWUnOiBtZW1iZXJzW2ldIH0KICAgICAgICAgIGdsb2JhbC5PTkxJTkUucHVzaCh0bXApCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGluZm8gPSBKU09OLnBhcnNlKGNoYXQuY29udGVudCkKICAgICAgICB2YXIgcm9vbXMgPSBKU09OLnBhcnNlKGluZm8ucm9vbV9pbmZvKSAvLyDogYrlpKnlrqTlkI3llq7lsI3mh4nkurrmlbgKICAgICAgICB2YXIgdXNlcnMgPSBpbmZvLnVzZXJfaW5mby5zcGxpdCgnLCcpIC8vIOiBiuWkqeWupOaJgOacieWcqOe3muS6uuWToQoKICAgICAgICAvKiDkuIrnt5rni4DmhYvorormm7QgKi8KICAgICAgICBmb3IgKHZhciBtZW1iZXIgb2YgZ2xvYmFsLk1FTUJFUlMpIHsKICAgICAgICAgIGlmICh1c2Vycy5pbmNsdWRlcyhtZW1iZXIudXNlcm5hbWUpKSB7CiAgICAgICAgICAgIG1lbWJlci5vbmxpbmUgPSB0cnVlCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtZW1iZXIub25saW5lID0gZmFsc2UKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qIOiBiuWkqeWupOS6uuaVuOiuiuabtCAqLwogICAgICAgIGxldCByb29tbGlzdF9zdGF0ZXMgPSAoT2JqZWN0LmtleXMocm9vbXMpKQoKICAgICAgICBmb3IgKGdsb2JhbC5ST09NIG9mIGdsb2JhbC5ST09NUykgewogICAgICAgICAgaWYgKHJvb21saXN0X3N0YXRlcy5pbmNsdWRlcyhnbG9iYWwuUk9PTS5yb29tX2lkKSkgewogICAgICAgICAgICBnbG9iYWwuUk9PTS5sZW4gPSByb29tc1tnbG9iYWwuUk9PTS5yb29tX2lkXQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAvLyDns7vntbHoqIrmga9leC7vvLjvvLjvvLjpm6LplovogYrlpKnlrqQKICAgICAgaXRlbS5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0ic3lzdGVtLXRleHQiPjxsYWJlbD5gICsgaW5mby50ZXh0ICsgYDwvbGFiZWw+PC9kaXY+YAogICAgfSBlbHNlIHsKICAgICAgLy8g5Yik5Yil5YWn5a655piv5ZCm5YyF5ZCr6Y+I57WQCiAgICAgIHZhciB0ZXh0ID0gaXNVcmwoY2hhdC5jb250ZW50KQoKICAgICAgLy8g5L6G6Ieq5YW25LuW55So5oi25oiW5L2/55So6ICF55qE5buj5pKt5raI5oGvCiAgICAgIGlmIChjaGF0LnR5cGUgPT09ICdBJykgewogICAgICAgIC8vIOaYr+engeioiueahOipseaKiuWFqOWfn+W7o+aSreaTi+S4i+S+hgogICAgICAgIGlmIChnbG9iYWwuUFJJVkFUSU9OID09PSAndHJ1ZScpIHsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KCiAgICAgICAgaXRlbS5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0iY2hhdC10ZXh0Ij5cCiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ic20tdGV4dCI+PHNwYW4gY2xhc3M9ImItdGV4dCI+YCArIGNoYXQuc2VuZGVyICsgYDwvc3Bhbj4gLSBgICsgY2hhdFRpbWUgKyBgIOW7o+aSrTwvbGFibGU+PGJyPlwKICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJicm8tdGV4dCI+YCArIHRleHQgKyBgPC9sYWJlbD5cCiAgICAgICAgICAgICAgPC9kaXY+YAogICAgICB9IGVsc2UgewogICAgICAgIGl0ZW0uaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImNoYXQtdGV4dCI+XAogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9InNtLXRleHQiPjxzcGFuIGNsYXNzPSJiLXRleHQiPmAgKyBjaGF0LnNlbmRlciArIGA8L3NwYW4+IC1gICsgY2hhdFRpbWUgKyBgPC9sYWJsZT48YnI+XAogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im1kLXRleHQiPmAgKyB0ZXh0ICsgYDwvbGFiZWw+XAogICAgICAgICAgICAgIDwvZGl2PmAKICAgICAgfQogICAgfQogICAgLy8g5omT5Y2w6KiK5oGvCiAgICBhcHBlbmRMb2coaXRlbSkKICB9CgogIC8v5bCH6IGK5aSp6KiK5oGv5pS+5YWl6IGK5aSp5Y2A5aGKCiAgZnVuY3Rpb24gYXBwZW5kTG9nKGl0ZW0pIHsKICAgIHZhciBkb1Njcm9sbCA9IGxvZy5zY3JvbGxUb3AgPiBsb2cuc2Nyb2xsSGVpZ2h0IC0gbG9nLmNsaWVudEhlaWdodCAtIDE7CiAgICBsb2cuYXBwZW5kQ2hpbGQoaXRlbSk7CgogICAgaWYgKGRvU2Nyb2xsKSB7CiAgICAgICAgbG9nLnNjcm9sbFRvcCA9IGxvZy5zY3JvbGxIZWlnaHQgLSBsb2cuY2xpZW50SGVpZ2h0OwogICAgfQogIH0KfQovLyDliKTmlrfmmK/lkKbngrrotoXpgKPntZAKZnVuY3Rpb24gaXNVcmwgKHYpIHsKICB2YXIgcmVnID0gLyhodHRwOlwvXC98aHR0cHM6XC9cLykoKFx3fD18XD98XC58XC98JnwjfC0pKykvZwogIHYgPSB2LnJlcGxhY2UocmVnLCBgPGEgaHJlZj0nJDEkMicgdGFyZ2V0PSJfYmxhbmsiPiQxJDI8L2E+YCkucmVwbGFjZSgvXG4vZywgJzxiciAvPicpCiAgcmV0dXJuIHYKfQpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0NoYXRMb2cnLAogIGRhdGE6IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgIG1zZzogJycsCiAgICAgIHR5cGU6ICdOJwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgc2VuZE1zZzogZnVuY3Rpb24gKCkgewogICAgICB2YXIgY29udGVudCA9IHRoaXMubXNnLnJlcGxhY2VBbGwoJ1wnJywgJyYjMzk7JykKICAgICAgaWYgKCFnbG9iYWwuQ09OTikgewogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9CiAgICAgIGlmICh0aGlzLm1zZyA9PT0gJycpIHsKICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgfQogICAgICBpZiAoZ2xvYmFsLlBSSVZBVElPTiA9PT0gJ3RydWUnKSB7CiAgICAgICAgdGhpcy50eXBlID0gJ1AnCiAgICAgIH0KICAgICAgdmFyIGpzdHIgPSBKU09OLnN0cmluZ2lmeSh7IHNlbmRlcjogZ2xvYmFsLlVTRVIsIHJvb21JZDogZ2xvYmFsLkNIQVRST09NLCByZWNpcGllbnQ6IGdsb2JhbC5SRUNJUElFTlQsIHR5cGU6IHRoaXMudHlwZSwgY29udGVudDogY29udGVudCwgdGltZTogRGF0ZS5ub3coKSB9KQogICAgICBnbG9iYWwuQ09OTi5zZW5kKGpzdHIpCiAgICAgIHRoaXMubXNnID0gJycKICAgIH0KICB9LAp9CgoK"},{"version":3,"sources":["ChatLog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAgBA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ChatLog.vue","sourceRoot":"src/components/chat_componenet","sourcesContent":["<template>\n    <div id=\"chat\">\n        <div id=\"log\"></div>\n        <div id=\"form\">\n            <form v-on:submit.prevent=\"sendMsg\" class=\"us-form form-inline\">\n                <select v-model=\"type\" id=\"msg-type\">\n                    <option value='N' selected>一般</option>\n                    <option value='A'>廣播</option>\n                </select>\n                <input v-model=\"msg\" class=\"w3-input w3-border w3-round\" type=\"text\" id=\"msg\" autofocus />\n                <button type=\"submit\">Send</button>\n            </form>\n        </div>\n    </div>\n</template>\n<script>\nimport global from '../gloval_var'\n/* ws */\nwindow.onload = function(){\n  var log = document.getElementById('log')\n\n  // WS連線：接收廣播訊息\n  if (window['WebSocket']) {\n    global.CONN = new WebSocket('ws://' + window.location.host +\"/ws\"+ location.pathname + location.search)\n    global.CONN.onclose = function () {\n      var item = document.createElement('div')\n      item.innerHTML = '<b>Connection closed.</b>'\n      appendLog(item)\n    }\n    global.CONN.onmessage = function (evt) {\n      var messages = evt.data.split('\\n')\n      for (var i = 0; i < messages.length; i++) {\n        HandleMessage(messages[i])\n      }\n    }\n  } else {\n    var item = document.createElement('div')\n    item.innerHTML = '<b>Your browser does not support WebSockets.</b>'\n    appendLog(item)\n  }\n\n\n\n  // 處理訊息\n  function HandleMessage (message) {\n    var item = document.createElement('div')\n    var chat = JSON.parse(message)\n    var chatTime = new Date(chat.time).toLocaleString('zh-TW')\n    // 判斷是否為系統訊息\n    if (chat.sender === 'SYS') {\n      // 系統hint 使用者名單\n      if (chat.type === 'H') {\n        var info = JSON.parse(chat.content)\n        global.ONLINE = [] // 清空原來的在線人員列表\n\n        if (global.CHATROOM !== info.room_info) {\n          alert('聊天室位置出錯!' + global.CHATROOM + info.room_info)\n        }\n\n        // 在線列表\n        var members = info.user_info.split(',')\n        for (let i = 0; i < members.length; i++) {\n          if (members[i] === global.USER) { continue }\n\n          let tmp = { 'username': members[i] }\n          global.ONLINE.push(tmp)\n        }\n      } else {\n        info = JSON.parse(chat.content)\n        var rooms = JSON.parse(info.room_info) // 聊天室名單對應人數\n        var users = info.user_info.split(',') // 聊天室所有在線人員\n\n        /* 上線狀態變更 */\n        for (var member of global.MEMBERS) {\n          if (users.includes(member.username)) {\n            member.online = true\n          } else {\n            member.online = false\n          }\n        }\n\n        /* 聊天室人數變更 */\n        let roomlist_states = (Object.keys(rooms))\n\n        for (global.ROOM of global.ROOMS) {\n          if (roomlist_states.includes(global.ROOM.room_id)) {\n            global.ROOM.len = rooms[global.ROOM.room_id]\n          }\n        }\n      }\n      // 系統訊息ex.ＸＸＸ離開聊天室\n      item.innerHTML = `<div class=\"system-text\"><label>` + info.text + `</label></div>`\n    } else {\n      // 判別內容是否包含鏈結\n      var text = isUrl(chat.content)\n\n      // 來自其他用戶或使用者的廣播消息\n      if (chat.type === 'A') {\n        // 是私訊的話把全域廣播擋下來\n        if (global.PRIVATION === 'true') {\n          return\n        }\n\n        item.innerHTML = `<div class=\"chat-text\">\\\n                  <label class=\"sm-text\"><span class=\"b-text\">` + chat.sender + `</span> - ` + chatTime + ` 廣播</lable><br>\\\n                  <label class=\"bro-text\">` + text + `</label>\\\n              </div>`\n      } else {\n        item.innerHTML = `<div class=\"chat-text\">\\\n                  <label class=\"sm-text\"><span class=\"b-text\">` + chat.sender + `</span> -` + chatTime + `</lable><br>\\\n                  <label class=\"md-text\">` + text + `</label>\\\n              </div>`\n      }\n    }\n    // 打印訊息\n    appendLog(item)\n  }\n\n  //將聊天訊息放入聊天區塊\n  function appendLog(item) {\n    var doScroll = log.scrollTop > log.scrollHeight - log.clientHeight - 1;\n    log.appendChild(item);\n\n    if (doScroll) {\n        log.scrollTop = log.scrollHeight - log.clientHeight;\n    }\n  }\n}\n// 判斷是否為超連結\nfunction isUrl (v) {\n  var reg = /(http:\\/\\/|https:\\/\\/)((\\w|=|\\?|\\.|\\/|&|#|-)+)/g\n  v = v.replace(reg, `<a href='$1$2' target=\"_blank\">$1$2</a>`).replace(/\\n/g, '<br />')\n  return v\n}\nexport default {\n  name: 'ChatLog',\n  data: function () {\n    return {\n      msg: '',\n      type: 'N'\n    }\n  },\n  methods: {\n    sendMsg: function () {\n      var content = this.msg.replaceAll('\\'', '&#39;')\n      if (!global.CONN) {\n        return false\n      }\n      if (this.msg === '') {\n        return false\n      }\n      if (global.PRIVATION === 'true') {\n        this.type = 'P'\n      }\n      var jstr = JSON.stringify({ sender: global.USER, roomId: global.CHATROOM, recipient: global.RECIPIENT, type: this.type, content: content, time: Date.now() })\n      global.CONN.send(jstr)\n      this.msg = ''\n    }\n  },\n}\n\n\n</script>\n"]}]}