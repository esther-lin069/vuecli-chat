{"remainingRequest":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/node_modules/vue-loader/lib/index.js??vue-loader-options!/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/src/components/chat_componenet/Room.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/src/components/chat_componenet/Room.vue","mtime":1606200747849},{"path":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Applications/MAMP/htdocs/esther_lin/work06/cli/new_chat/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBWdWUgZnJvbSAndnVlJwppbXBvcnQgZ2xvYmFsIGZyb20gJy4uL2dsb3ZhbF92YXInCi8vIGltcG9ydCBtZW1iZXJfY29tcG8gZnJvbSAnLi9NZW1iZXInCgovLyDmm7/mj5vlj4PmlbgKZnVuY3Rpb24gcmVwbGFjZVF1ZXJ5UGFyYW0gKHBhcmFtLCBuZXd2YWwsIHNlYXJjaCkgewogIHZhciByZWdleCA9IG5ldyBSZWdFeHAoJyhbPzsmXSknICsgcGFyYW0gKyAnW14mO10qWzsmXT8nKQogIHZhciBxdWVyeSA9IHNlYXJjaC5yZXBsYWNlKHJlZ2V4LCAnJDEnKS5yZXBsYWNlKC8mJC8sICcnKQoKICByZXR1cm4gKHF1ZXJ5Lmxlbmd0aCA+IDIgPyBxdWVyeSArICcmJyA6ICc/JykgKyAobmV3dmFsID8gcGFyYW0gKyAnPScgKyBuZXd2YWwgOiAnJykKfQoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdSb29tJywKICBkYXRhOiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gewogICAgICByb29tczogZ2xvYmFsLlJPT01TLAogICAgICB0aXRsZTogZ2xvYmFsLkNIQVRST09NLAogICAgICBzZWVuX2xlYXZlOiB0cnVlLAogICAgICBzZWVuX2RlbDogdHJ1ZSwKICAgICAgaXNfcHJpdmF0ZTogJycKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICAvL+WIpOaWt+aYr+WQpueCuuWkp+W7s+WSjOengeiBigogICAgaWYgKGdsb2JhbC5QUklWQVRJT04gPT0gInRydWUiIHx8IGdsb2JhbC5DSEFUUk9PTSA9PSAibWFpbiIpIHsKICAgICAgICBpZiAoZ2xvYmFsLlBSSVZBVElPTiA9PSAidHJ1ZSIpIHsKICAgICAgICAgICAgLy8g6Kq/5pW05qiZ6aGMCiAgICAgICAgICAgIHRoaXMuaXNfcHJpdmF0ZSA9ICI8cCBzdHlsZT0nZm9udC1zaXplOjEycHQ7IGNvbG9yOiMwMDc5OEYnPuengeiBijwvcD4iCiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aGlzLnRpdGxlLnJlcGxhY2UoZ2xvYmFsLlVTRVIsICcnKS5yZXBsYWNlKCctJywgJycpCgogICAgICAgICAgICAvLyDnm7TmjqXpoa/npLrmiYDmnInkvb/nlKjogIXogIzpnZ7lnKjnt5rliJfooagKICAgICAgICAgICAgLy8gbWVtYmVyX2NvbXBvLiRkYXRhLnNlZW4gPSBmYWxzZQoKICAgICAgICAgICAgLy8g5Y+W5Ye65pS26Kmx5Lq6CiAgICAgICAgICAgIGxldCBtZW1iZXJzID0gZ2xvYmFsLkNIQVRST09NLnNwbGl0KCItIikKICAgICAgICAgICAgaWYgKG1lbWJlcnNbMF0gPT0gZ2xvYmFsLlVTRVIpIHsKICAgICAgICAgICAgICAgIGdsb2JhbC5SRUNJUElFTlQgPSBtZW1iZXJzWzFdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBnbG9iYWwuUkVDSVBJRU5UID0gbWVtYmVyc1swXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIOmaseiXj+WIqumZpOiIh+mboumWi+aMiemIlQogICAgICAgIHRoaXMuc2Vlbl9sZWF2ZSA9IGZhbHNlCiAgICAgICAgdGhpcy5zZWVuX2RlbCA9IGZhbHNlCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBnb1RvUm9vbSAocm9vbV9pZCkgewogICAgICBsZXQgc2VhcmNoID0gcmVwbGFjZVF1ZXJ5UGFyYW0oJ3ByaXZhdGUnLCAnZmFsc2UnLCBsb2NhdGlvbi5zZWFyY2gpCiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gZ2xvYmFsLkhPU1QgKyAnL2NoYXQvJyArIHJvb21faWQgKyBzZWFyY2gKICAgIH0sCiAgICBpblJvb20ocm9vbSl7CiAgICAgIHJldHVybiAocm9vbSA9PT0gZ2xvYmFsLkNIQVRST09NKSA/IGluUm9vbVN5bWIgOiAnJwogICAgfSwKICAgIERlbGV0ZVJvb206IGZ1bmN0aW9uICgpIHsKICAgICAgc3dhbERlbFJvb20odGhpcy50aXRsZSkKICAgIH0sCiAgICBMZWF2ZVJvb206IGZ1bmN0aW9uICgpIHsKICAgICAgbGVhdmVSb29tKHRoaXMudGl0bGUpCiAgICB9LAogICAgTmV3Um9vbTogZnVuY3Rpb24gKCkgewogICAgICBWdWUuc3dhbCh7CiAgICAgICAgdGl0bGU6ICflu7rnq4sv5YmN5b6AIOiBiuWkqeWupCcsCiAgICAgICAgdGV4dDogJ+iBiuWkqeWupGlkOicsCiAgICAgICAgaW5wdXQ6ICd0ZXh0JywKICAgICAgfSkudGhlbihmdW5jdGlvbiAoaW5wdXRWYWx1ZSkgewogICAgICAgIGlmIChpbnB1dFZhbHVlID09PSBudWxsKSByZXR1cm4gZmFsc2UKICAgICAgICBpZiAoaW5wdXRWYWx1ZSA9PT0gJycpIHsKICAgICAgICAgIFZ1ZS5zd2FsKCflk47lkabigKbigKYnLCAn6KuL6Ly45YWl6IGK5aSp5a6kaWQnLCAnZXJyb3InKQogICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIGlmIChpbnB1dFZhbHVlLmxlbmd0aCA+IDMwKSB7CiAgICAgICAgICBWdWUuc3dhbCgn5aSq4oCm6ZW34oCm4oCm5ZWmJywgJ+iBiuWkqeWupGlk54K6MzDlrZflhYPlhacnLCAnd2FybmluZycpCiAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CgogICAgICAgIFZ1ZS5heGlvcyh7CiAgICAgICAgICBtZXRob2Q6ICdwb3N0JywKICAgICAgICAgIHVybDogZ2xvYmFsLkFQSSArICcvbm9ybWFscm9vbScsCiAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICd1c2VyJzogZ2xvYmFsLlVTRVIsCiAgICAgICAgICAgICdyb29tTmFtZSc6IGlucHV0VmFsdWUudmFsdWUsCiAgICAgICAgICAgICd3aXRoJzogJycKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZXMucmVxdWVzdC5yZXNwb25zZVVSTAogICAgICAgIH0pCiAgICAgIH0pCiAgICB9CiAgfSwKICBtb3VudGVkICgpIHsKICAgIHRoaXMuYXhpb3MKICAgICAgLmdldChnbG9iYWwuQVBJICsgJy9yb29tbGlzdCcgKyBsb2NhdGlvbi5zZWFyY2gpCiAgICAgIC50aGVuKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgbGV0IGxpc3QgPSBlLmRhdGEucm9vbXMuc3BsaXQoJywnKQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgbGV0IHRtcCA9IHsgJ2lkJzogaSwgJ3Jvb21faWQnOiBsaXN0W2ldLCAnbGVuJzogMCB9CiAgICAgICAgICBnbG9iYWwuUk9PTVMucHVzaCh0bXApCiAgICAgICAgfQogICAgICB9KQogIH0KfQoKdmFyIGluUm9vbVN5bWIgPSBgPGkgY2xhc3M9ImZhcyBmYS1maXNoIiBzdHlsZT0ibWFyZ2luLXJpZ2h0OjAuNWVtO2NvbG9yOiMwMDc5OEYiPjwvaT5gCi8vIOWIqumZpOaIv+mWk+S4reS7i+m7ngpmdW5jdGlvbiBzd2FsRGVsUm9vbSAocm9vbV9pZCkgewogIFZ1ZS5zd2FsKHsKICAgIHRpdGxlOiAn5Yiq6Zmk6Kmy6IGK5aSp5a6k77yfJywKICAgIHRleHQ6ICfoqbLogYrlpKnlrqTos4fmlpnoiIfogYrlpKnoqJjpjITmnIPlhajpg6jmtojlpLEnLAogICAgc2hvd0NhbmNlbEJ1dHRvbiA6IHRydWUsCiAgICBjb25maXJtQnV0dG9uVGV4dDogJ+eiuuWumicsCiAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJwogIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgaWYgKHJlc3VsdC5pc0NvbmZpcm1lZCkgewogICAgICBkZWxSb29tKHJvb21faWQpCiAgICB9CiAgfSkKfQoKLy8g5Yiq6Zmk5oi/6ZaT77yI6LOH5paZ5bqr77yJCmZ1bmN0aW9uIGRlbFJvb20gKGlkKSB7CiAgVnVlLmF4aW9zLmdldChnbG9iYWwuQVBJICsgJy9kZWxldGUvJysgaWQgKyAnP3VzZXI9JyArIGdsb2JhbC5VU0VSKQogIC50aGVuKChyZXMpID0+IHsKICAgIFZ1ZS5zd2FsKCfmiJDlip/liKrpmaQnLCBpZCArICfogYrlpKnlrqTlkKvmt5rot5/kvaDoqqrlho3oposnLCAnc3VjY2VzcycpCiAgICBzZXRUaW1lb3V0KCgpID0+IHsgd2luZG93LmxvY2F0aW9uID0gcmVzLnJlcXVlc3QucmVzcG9uc2VVUkwgfSwgMTUwMCkKICB9KS5jYXRjaCgoZXJyKSA9PiB7CiAgICBWdWUuc3dhbChlcnIgKyAn5Ye66Yyv5LqG77yB5Yiq6Zmk5aSx5pWX77yBJywgaWQgKyAn6IGK5aSp5a6k6Zmw6a2C5LiN5pWj772eJywgJ2Vycm9yJykKICB9KQp9CgovLyDpm6LplovmiL/plpPvvIjliKrpmaTmiL/plpPoiIfoh6rlt7HnmoTpl5zoga/vvL/os4fmlpnluqvvvIkKZnVuY3Rpb24gbGVhdmVSb29tIChpZCkgewogIFZ1ZS5heGlvcyh7CiAgICBtZXRob2Q6ICdnZXQnLAogICAgdXJsOiBnbG9iYWwuQVBJICsgJy9sZWF2ZS8nICsgaWQgKyAnP3VzZXI9JyArIGdsb2JhbC5VU0VSCiAgfSkudGhlbigocmVzKSA9PiB7CiAgICBWdWUuc3dhbCgn5oKo5bey6YCA5Ye66IGK5aSp5a6kJywgaWQgKyAn6KOh55qE5pyL5Y+L5YCR5pyD5oOz5b+15L2g55qEJywgJ3N1Y2Nlc3MnKQogICAgc2V0VGltZW91dCgoKSA9PiB7IHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmVzLnJlcXVlc3QucmVzcG9uc2VVUkwgfSwgMTUwMCkKICB9KS5jYXRjaCgoKSA9PiB7CiAgICBWdWUuc3dhbCgn5Ye66Yyv5LqG77yBJywgaWQgKyAn6IGK5aSp5a6k5LiN5oOz6IiH5L2g5YiG6ZaL772eJywgJ2Vycm9yJykKICB9KQp9Cgo="},{"version":3,"sources":["Room.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Room.vue","sourceRoot":"src/components/chat_componenet","sourcesContent":["<template>\n    <div>\n        <div id=\"room\">\n        <div id=\"room-title\">\n            <div class=\"room-title\">\n                <!-- 聊天室名稱 -->\n                <h1 class=\"title-text div-ell\"><span v-html=\"is_private\"></span>{{ title }}</h1>\n                <div v-if=\"title !== 'main'\">\n                  <!-- 刪除聊天室按鈕 -->\n                  <button class=\"exit-btn\" v-show=\"seen_del\" @click=\"DeleteRoom\">刪除房間</button>\n                  <!-- 離開聊天室按鈕 -->\n                  <button class=\"exit-btn\" v-show=\"seen_leave\" @click=\"LeaveRoom\">退出房間</button>\n                </div>\n            </div>\n            <h5 class=\"title-text\">聊天室列表\n                <button @click=\"NewRoom\" class=\"new-room-btn\">\n                    <svg viewBox=\"0 0 16 16\" fill=\"#00798F\" xmlns=\"http://www.w3.org/2000/svg\">\n                        <path fill-rule=\"evenodd\"\n                            d=\"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z\" />\n                    </svg>\n                </button>\n            </h5>\n        </div>\n\n        <div id=\"rooms\">\n            <!-- 聊天室列表 -->\n            <div id=\"roomList\">\n                <button @click=\"goToRoom('main')\" class=\"mh20 room-box-text room-btn\" value=\"main\">大廳</button>\n                <dl>\n                    <!-- 大廳除外的聊天室列表 -->\n                    <dt v-for=\"(room, index) in rooms\" :room=\"room\" :key=\"index\">\n                      <button @click=\"goToRoom(room.room_id)\" class=\"mh20 room-box-text room-btn\">\n                        <span v-html=\"inRoom(room.room_id)\"></span>\n                        {{ room.room_id }} ({{ room.len }})\n                      </button>\n                    </dt>\n                </dl>\n            </div>\n        </div>\n    </div>\n    </div>\n</template>\n\n<script>\nimport Vue from 'vue'\nimport global from '../gloval_var'\n// import member_compo from './Member'\n\n// 替換參數\nfunction replaceQueryParam (param, newval, search) {\n  var regex = new RegExp('([?;&])' + param + '[^&;]*[;&]?')\n  var query = search.replace(regex, '$1').replace(/&$/, '')\n\n  return (query.length > 2 ? query + '&' : '?') + (newval ? param + '=' + newval : '')\n}\n\nexport default {\n  name: 'Room',\n  data: function () {\n    return {\n      rooms: global.ROOMS,\n      title: global.CHATROOM,\n      seen_leave: true,\n      seen_del: true,\n      is_private: ''\n    }\n  },\n  created() {\n    //判斷是否為大廳和私聊\n    if (global.PRIVATION == \"true\" || global.CHATROOM == \"main\") {\n        if (global.PRIVATION == \"true\") {\n            // 調整標題\n            this.is_private = \"<p style='font-size:12pt; color:#00798F'>私聊</p>\"\n            this.title = this.title.replace(global.USER, '').replace('-', '')\n\n            // 直接顯示所有使用者而非在線列表\n            // member_compo.$data.seen = false\n\n            // 取出收話人\n            let members = global.CHATROOM.split(\"-\")\n            if (members[0] == global.USER) {\n                global.RECIPIENT = members[1]\n            }\n            else {\n                global.RECIPIENT = members[0]\n            }\n        }\n        // 隱藏刪除與離開按鈕\n        this.seen_leave = false\n        this.seen_del = false\n    }\n  },\n  methods: {\n    goToRoom (room_id) {\n      let search = replaceQueryParam('private', 'false', location.search)\n      window.location.href = global.HOST + '/chat/' + room_id + search\n    },\n    inRoom(room){\n      return (room === global.CHATROOM) ? inRoomSymb : ''\n    },\n    DeleteRoom: function () {\n      swalDelRoom(this.title)\n    },\n    LeaveRoom: function () {\n      leaveRoom(this.title)\n    },\n    NewRoom: function () {\n      Vue.swal({\n        title: '建立/前往 聊天室',\n        text: '聊天室id:',\n        input: 'text',\n      }).then(function (inputValue) {\n        if (inputValue === null) return false\n        if (inputValue === '') {\n          Vue.swal('哎呦……', '請輸入聊天室id', 'error')\n          return false\n        }\n        if (inputValue.length > 30) {\n          Vue.swal('太…長……啦', '聊天室id為30字元內', 'warning')\n          return false\n        }\n\n        Vue.axios({\n          method: 'post',\n          url: global.API + '/normalroom',\n          data: {\n            'user': global.USER,\n            'roomName': inputValue.value,\n            'with': ''\n          }\n        }).then((res) => {\n            window.location.href = res.request.responseURL\n        })\n      })\n    }\n  },\n  mounted () {\n    this.axios\n      .get(global.API + '/roomlist' + location.search)\n      .then(function (e) {\n        let list = e.data.rooms.split(',')\n        for (let i = 0; i < list.length; i++) {\n          let tmp = { 'id': i, 'room_id': list[i], 'len': 0 }\n          global.ROOMS.push(tmp)\n        }\n      })\n  }\n}\n\nvar inRoomSymb = `<i class=\"fas fa-fish\" style=\"margin-right:0.5em;color:#00798F\"></i>`\n// 刪除房間中介點\nfunction swalDelRoom (room_id) {\n  Vue.swal({\n    title: '刪除該聊天室？',\n    text: '該聊天室資料與聊天記錄會全部消失',\n    showCancelButton : true,\n    confirmButtonText: '確定',\n    cancelButtonText: '取消'\n  }).then((result) => {\n    if (result.isConfirmed) {\n      delRoom(room_id)\n    }\n  })\n}\n\n// 刪除房間（資料庫）\nfunction delRoom (id) {\n  Vue.axios.get(global.API + '/delete/'+ id + '?user=' + global.USER)\n  .then((res) => {\n    Vue.swal('成功刪除', id + '聊天室含淚跟你說再見', 'success')\n    setTimeout(() => { window.location = res.request.responseURL }, 1500)\n  }).catch((err) => {\n    Vue.swal(err + '出錯了！刪除失敗！', id + '聊天室陰魂不散～', 'error')\n  })\n}\n\n// 離開房間（刪除房間與自己的關聯＿資料庫）\nfunction leaveRoom (id) {\n  Vue.axios({\n    method: 'get',\n    url: global.API + '/leave/' + id + '?user=' + global.USER\n  }).then((res) => {\n    Vue.swal('您已退出聊天室', id + '裡的朋友們會想念你的', 'success')\n    setTimeout(() => { window.location.href = res.request.responseURL }, 1500)\n  }).catch(() => {\n    Vue.swal('出錯了！', id + '聊天室不想與你分開～', 'error')\n  })\n}\n\n</script>\n"]}]}